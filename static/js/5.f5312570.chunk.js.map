{"version":3,"sources":["services/index.js","hooks/index.js","pages/Home/index.js"],"names":["GooglePhotoClient","tokenObj","this","token","token_type","access_token","a","pageSize","nextPageToken","url","fetch","method","headers","Authorization","resp","status","Error","json","data","albumId","bodyParams","pageToken","body","JSON","stringify","ALLOW_ALBUMS","useListAlbums","useState","albums","setAlbums","setNextPageToken","auth","useAuth","fetchNext","client","getListAlbums","filter","item","includes","id","useEffect","useListPhotoInAlbum","photos","setPhotos","getPhotoInAlbum","mediaItems","mimeType","startsWith","to","i","x","y","scale","rot","Math","random","delay","trans","r","s","Home","setPage","usePage","Set","gone","currentAlbum","setCurrentAlbum","useSprings","length","from","props","set","bind","useGesture","index","args","down","xDelta","delta","xDir","distance","direction","velocity","trigger","dir","add","name","params","isGone","has","window","innerWidth","undefined","config","friction","tension","size","clear","images","map","availWidth","min","screen","style","transform","interpolate","backgroundImage","coverPhotoBaseUrl","backgroundSize","div","className","title"],"mappings":"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","file":"static/js/5.f5312570.chunk.js","sourcesContent":["export class GooglePhotoClient {\n  constructor(tokenObj) {\n    this.token = `${tokenObj.token_type} ${tokenObj.access_token}`;\n  }\n\n  async getListAlbums(pageSize = 10, nextPageToken = null) {\n    let url = `https://photoslibrary.googleapis.com/v1/albums?&pageSize=${pageSize}`;\n    if (nextPageToken) {\n      url += `&pageToken=${nextPageToken}`;\n    }\n    const resp = await fetch(url, {\n      method: \"GET\",\n      headers: {\n        Authorization: this.token,\n      },\n    });\n\n    if (resp.status !== 200) {\n      throw new Error(\"Fail to load list albums\");\n    }\n    const data = await resp.json();\n    return data;\n  }\n\n  async getPhotoInAlbum(albumId, pageSize = 10, nextPageToken = null) {\n    let url = \"https://photoslibrary.googleapis.com/v1/mediaItems:search\";\n    const bodyParams = {\n      albumId: albumId,\n      pageSize: pageSize,\n      pageToken: nextPageToken,\n    };\n    const resp = await fetch(url, {\n      method: \"POST\",\n      headers: {\n        Authorization: this.token,\n      },\n      body: JSON.stringify(bodyParams),\n    });\n    if (resp.status !== 200) {\n      throw new Error(\"Fail to load list photo in the album\");\n    }\n    const data = await resp.json();\n    return data;\n  }\n}\n","import { useState, useEffect } from \"react\";\nimport { useAuth } from \"../contexts\";\nimport { GooglePhotoClient } from \"../services\";\n\nconst ALLOW_ALBUMS = [\n  \"AFQKIAIDtGHas7h0c5nnnlDez-2BSpsbZldeRUAaI0TEU3DY2ktGwZu6oDQff6w9M_CWnhK-823B\",\n  \"AFQKIAIDT9DT3pScu6fNwkuooH8haUjBQdePIoesJqMg3LD4TypzWPRESMtZ5zoA97yzpL0g9Y1g\",\n  \"AFQKIAIdl9voQbVKtwOROkREXucrQQ0GlXaCy8ZUSemJZsPCeXHG3DRnuwC99cMu0ARP-WzCL_zT\",\n];\n\nexport function useListAlbums(pageSize = 10) {\n  const [albums, setAlbums] = useState([]);\n  const [nextPageToken, setNextPageToken] = useState();\n  const auth = useAuth();\n\n  const fetchNext = async () => {\n    if (auth) {\n      const client = new GooglePhotoClient(auth.tokenObj);\n      const data = await client.getListAlbums(pageSize, nextPageToken);\n      setNextPageToken(data.nextPageToken);\n      // setAlbums([...albums, ...data.albums]);\n      setAlbums(data.albums.filter((item) => ALLOW_ALBUMS.includes(item.id)));\n    }\n  };\n\n  useEffect(() => {\n    fetchNext();\n  }, [auth]);\n\n  return { albums, fetchNext };\n}\n\nexport function useListPhotoInAlbum(albumId, pageSize = 10) {\n  const [photos, setPhotos] = useState([]);\n  const [nextPageToken, setNextPageToken] = useState();\n  const auth = useAuth();\n\n  const fetchNext = async () => {\n    if (auth) {\n      const client = new GooglePhotoClient(auth.tokenObj);\n      const data = await client.getPhotoInAlbum(\n        albumId,\n        pageSize,\n        nextPageToken\n      );\n      setNextPageToken(data.nextPageToken);\n      // setPhotos([...photos, ...data.mediaItems]);\n      setPhotos(\n        data.mediaItems.filter((item) => item.mimeType.startsWith(\"image\"))\n      );\n    }\n  };\n\n  useEffect(() => {\n    fetchNext();\n  }, [auth]);\n\n  return { photos, fetchNext };\n}\n","import React, { useState, useEffect } from \"react\";\nimport { useGesture } from \"react-use-gesture\";\nimport { useSprings, animated, interpolate } from \"react-spring\";\nimport { useListAlbums } from \"../../hooks\";\nimport { usePage } from \"../../contexts\";\nimport \"./style.scss\";\n\nconst to = (i) => ({\n  x: 0,\n  y: i * -4,\n  scale: 1,\n  rot: -10 + Math.random() * 20,\n  delay: i * 100,\n});\nconst from = (i) => ({ x: 0, rot: 0, scale: 1.5, y: -1000 });\n\nconst trans = (r, s) =>\n  `perspective(1500px) rotateX(30deg) rotateY(${\n    r / 10\n  }deg) rotateZ(${r}deg) scale(${s})`;\n\nexport default function Home() {\n  const { albums } = useListAlbums(49);\n  const { setPage } = usePage();\n  const [gone] = useState(() => new Set()); // The set flags all the cards that are flicked out\n  const [currentAlbum, setCurrentAlbum] = useState(0);\n  const [props, set] = useSprings(albums.length, (i) => ({\n    ...to(i),\n    from: from(i),\n  })); // Create a bunch of springs using the helpers above\n  // Create a gesture, we're interested in down-state, delta (current-pos - click-pos), direction and velocity\n\n  useEffect(() => {\n    albums && albums.length > 0 && setCurrentAlbum(albums.length - 1);\n  }, [albums]);\n\n  const bind = useGesture(\n    ({\n      args: [index],\n      down,\n      delta: [xDelta],\n      distance,\n      direction: [xDir],\n      velocity,\n    }) => {\n      const trigger = velocity > 0.2; // If you flick hard enough it should trigger the card to fly out\n      const dir = xDir < 0 ? -1 : 1; // Direction should either point left or right\n      if (!down && trigger) {\n        setCurrentAlbum(currentAlbum - 1);\n        gone.add(index);\n      } // If button/finger's up and trigger velocity is reached, we flag the card ready to fly out\n      else if (!down && !trigger) {\n        setPage({ name: \"album\", params: { albumId: albums[index].id } });\n      }\n      set((i) => {\n        if (index !== i) return; // We're only interested in changing spring-data for the current spring\n        const isGone = gone.has(index);\n        const x = isGone ? (200 + window.innerWidth) * dir : down ? xDelta : 0; // When a card is gone it flys out left or right, otherwise goes back to zero\n        const rot = xDelta / 100 + (isGone ? dir * 10 * velocity : 0); // How much the card tilts, flicking it harder makes it rotate faster\n        const scale = down ? 1.1 : 1; // Active cards lift up a bit\n        return {\n          x,\n          rot,\n          scale,\n          delay: undefined,\n          config: { friction: 50, tension: down ? 800 : isGone ? 200 : 500 },\n        };\n      });\n      if (!down && gone.size === albums.length) {\n        setCurrentAlbum(albums.length - 1);\n        gone.clear() || set((i) => to(i));\n      }\n    }\n  );\n\n  // Now we're just mapping the animated values to our view, that's it. Btw, this component only renders once. :-)\n  const images = props.map(({ x, y, rot, scale }, i) => {\n    const availWidth = Math.min(window.screen.availWidth, 660);\n    const style = {\n      transform: interpolate([rot, scale], trans),\n      backgroundImage: `url(${albums[i].coverPhotoBaseUrl}=w${availWidth})`,\n      backgroundSize: \"100%\",\n    };\n\n    return (\n      <animated.div\n        key={i}\n        style={{\n          transform: interpolate(\n            [x, y],\n            (x, y) => `translate3d(${x}px,${y}px,0)`\n          ),\n        }}\n      >\n        {/* This is the card itself, we're binding our gesture to it (and inject its index so we know which is which) */}\n        <animated.div {...bind(i)} style={style} />\n      </animated.div>\n    );\n  });\n  return (\n    <div className=\"Home BackApp\">\n      <div className=\"bg\"></div>\n      <div className=\"AppHeader\">\n        {albums && albums[currentAlbum] && albums[currentAlbum].title}\n      </div>\n      <div className=\"ListAlbum\">{images}</div>\n    </div>\n  );\n}\n"],"sourceRoot":""}